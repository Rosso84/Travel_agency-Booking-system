<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:sec="http://www.springframework.org/security/tags"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:p="http://xmlns.jcp.org/jsf/passthrough">


<ui:composition template="/layout.xhtml">

    <ui:define name="title">
        Travel Agency
    </ui:define>


    <ui:define name="content">


        <sec:authenticated>
            <h:form>
                <h:outputText value="Search trips by country (e.g 'Marocco'): "/>
                <h:inputText id="inputTxtLocationId" class="login" value="#{tripController.location}"/>
                <h:commandButton id="btnSubmitSearchLocationId" value="Search" class="gameBtn"
                                 action="#{tripController.retrieveTripsByLocation( tripController.location )}"/>
                <br/>
                <c:choose>
                    <c:when test="#{tripController.tripsByLocationListIsEmptyOrNull}">
                        <p>Available trips for '#{tripController.location}'</p>
                    </c:when>
                    <c:otherwise>
                        <c:forEach var="trip" items="#{tripController.tripsByLocationList}">
                            <a id="linkToTripDetailId" href="tripDetail.jsf" class="btn">
                                <p>#{trip.title}</p>
                                <p>#{trip.description}</p>
                                <p>#{trip.cost} NOK</p>
                            </a>
                            <br/>
                        </c:forEach>
                    </c:otherwise>
                </c:choose>

            </h:form>

            <h2>Top #{tripController.numberOfTopTrips} Trips</h2>

            <c:forEach var="trip" items="#{tripController.topNTripsList}">
                <h:form prependId="false">
                    <h:commandButton
                            value="#{trip.location} Price:#{trip.cost}    #{trip.description}"
                            action="#{ purchaseController.bookTrip( userInfoController.userName, trip.id ) }"
                            class="gameBtn"
                    />
                </h:form>
            </c:forEach>

            <br/>


        </sec:authenticated>


        <sec:anonymous>
            <h:form>
             <h:outputText value="Search trips by country (e.g 'Marocco'): "/>
                <h:inputText id="inputTxtLocationIdAnonymous" value="#{tripController.location}" class="login"/>
                <h:commandButton id="btnSubmitSearchLocationIdAnonymous" value="Search"
                                 action="#{tripController.retrieveTripsByLocation ( tripController.location )}"
                                 class="btn btn-white btn-animation-1"/>
                <br/>

                <c:forEach var="trip" items="#{tripController.tripsByLocationList}">
                    <a href="tripDetail.jsf" class="btn">
                        #{trip.location},  #{trip.title},  #{trip.cost}NOK
                    </a>
                </c:forEach>
            </h:form>

            <br/>

            <h4>Top #{tripController.numberOfTopTrips} Trips</h4>
            <c:forEach var="trip" items="#{tripController.topNTripsList}">
                <h:form prependId="false">
                   <a href="tripDetail.jsf" class="btn">
                        #{trip.location},  #{trip.title},  #{trip.cost}NOK
                    </a>
                    <br/>
                </h:form>
            </c:forEach>
        </sec:anonymous>

    </ui:define>

</ui:composition>
</html>
